<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/cl/duoc/maestranza_v2/ui/screens/users/UsersScreenCompact.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/cl/duoc/maestranza_v2/ui/screens/users/UsersScreenCompact.kt" />
              <option name="originalContent" value="package cl.duoc.maestranza_v2.ui.screens.users&#10;&#10;import android.annotation.SuppressLint&#10;import androidx.compose.foundation.horizontalScroll&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Add&#10;import androidx.compose.material.icons.filled.FilterList&#10;import androidx.compose.material.icons.filled.Search&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import androidx.navigation.NavController&#10;import androidx.navigation.compose.rememberNavController&#10;import cl.duoc.maestranza_v2.model.User&#10;import cl.duoc.maestranza_v2.ui.components.AddUserBottomSheet&#10;import cl.duoc.maestranza_v2.ui.components.UserCard&#10;import cl.duoc.maestranza_v2.ui.components.UsersFilterBottomSheet&#10;import cl.duoc.maestranza_v2.ui.theme.Maestranza_V2Theme&#10;import cl.duoc.maestranza_v2.viewmodel.MainViewModel&#10;import cl.duoc.maestranza_v2.viewmodel.UsersViewModel&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun UserScreenCompact(&#10;    navController: NavController,&#10;    viewModel: MainViewModel,&#10;    usersViewModel: UsersViewModel = viewModel()&#10;) {&#10;    val uiState by usersViewModel.uiState.collectAsState()&#10;    var showFilters by remember { mutableStateOf(false) }&#10;    var showDeleteDialog by remember { mutableStateOf(false) }&#10;    var showToggleDialog by remember { mutableStateOf(false) }&#10;    var showAddUser by remember { mutableStateOf(false) }&#10;    var userToModify by remember { mutableStateOf&lt;User?&gt;(null) }&#10;&#10;    cl.duoc.maestranza_v2.ui.components.ScaffoldWrapper(&#10;        navController = navController,&#10;        showDrawer = true,&#10;        title = &quot;Usuarios&quot;,&#10;        actions = {&#10;            IconButton(onClick = { showFilters = true }) {&#10;                Icon(Icons.Default.FilterList, contentDescription = &quot;Filtros&quot;)&#10;            }&#10;        },&#10;        floatingActionButton = {&#10;            FloatingActionButton(&#10;                onClick = { showAddUser = true }&#10;            ) {&#10;                Icon(Icons.Default.Add, contentDescription = &quot;Agregar usuario&quot;)&#10;            }&#10;        }&#10;    ) { innerPadding -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .padding(innerPadding)&#10;                .fillMaxSize()&#10;                .padding(horizontal = 16.dp)&#10;        ) {&#10;            // Campo de búsqueda&#10;            OutlinedTextField(&#10;                value = uiState.query,&#10;                onValueChange = usersViewModel::onQueryChange,&#10;                label = { Text(&quot;Buscar por usuario, nombre o email&quot;) },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                trailingIcon = { Icon(Icons.Default.Search, null) },&#10;                singleLine = true&#10;            )&#10;&#10;            Spacer(Modifier.height(8.dp))&#10;&#10;            // Chips con filtros activos&#10;            if (uiState.filters.selectedRoles.isNotEmpty() || uiState.filters.statusFilter != cl.duoc.maestranza_v2.model.UserStatusFilter.All) {&#10;                Row(Modifier.horizontalScroll(rememberScrollState())) {&#10;                    uiState.filters.selectedRoles.forEach { role -&gt;&#10;                        val roleFormatted = when (role) {&#10;                            &quot;ROLE_ADMINISTRADOR&quot; -&gt; &quot;Administrador&quot;&#10;                            &quot;ROLE_AUDITOR&quot; -&gt; &quot;Auditor&quot;&#10;                            &quot;ROLE_COMPRAS&quot; -&gt; &quot;Compras&quot;&#10;                            &quot;ROLE_VENTAS&quot; -&gt; &quot;Ventas&quot;&#10;                            &quot;ROLE_SUPERVISOR&quot; -&gt; &quot;Supervisor&quot;&#10;                            &quot;ROLE_EMPLEADO&quot; -&gt; &quot;Empleado&quot;&#10;                            else -&gt; role&#10;                        }&#10;                        AssistChip(&#10;                            onClick = { showFilters = true },&#10;                            label = { Text(roleFormatted) },&#10;                            trailingIcon = {&#10;                                Icon(&#10;                                    Icons.Default.FilterList,&#10;                                    contentDescription = null,&#10;                                    modifier = Modifier.size(16.dp)&#10;                                )&#10;                            }&#10;                        )&#10;                        Spacer(Modifier.width(8.dp))&#10;                    }&#10;&#10;                    if (uiState.filters.statusFilter != cl.duoc.maestranza_v2.model.UserStatusFilter.All) {&#10;                        AssistChip(&#10;                            onClick = { showFilters = true },&#10;                            label = { Text(uiState.filters.statusFilter.name) },&#10;                            trailingIcon = {&#10;                                Icon(&#10;                                    Icons.Default.FilterList,&#10;                                    contentDescription = null,&#10;                                    modifier = Modifier.size(16.dp)&#10;                                )&#10;                            }&#10;                        )&#10;                    }&#10;                }&#10;                Spacer(Modifier.height(8.dp))&#10;            }&#10;&#10;            // Lista de usuarios con cards&#10;            LazyColumn(&#10;                verticalArrangement = Arrangement.spacedBy(8.dp),&#10;                modifier = Modifier.fillMaxSize()&#10;            ) {&#10;                items(uiState.filteredUsers, key = { it.id }) { user -&gt;&#10;                    UserCard(&#10;                        user = user,&#10;                        onClick = { /* TODO: Detalle rápido */ },&#10;                        onEdit = { userId -&gt;&#10;                            navController.navigate(&#10;                                cl.duoc.maestranza_v2.navigation.Screen.EditUser.createRoute(userId)&#10;                            )&#10;                        },&#10;                        onToggleActive = {&#10;                            userToModify = user&#10;                            showToggleDialog = true&#10;                        },&#10;                        onDelete = {&#10;                            userToModify = user&#10;                            showDeleteDialog = true&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;&#10;        // Bottom sheet de filtros&#10;        if (showFilters) {&#10;            UsersFilterBottomSheet(&#10;                availableRoles = uiState.availableRoles,&#10;                selectedRoles = uiState.filters.selectedRoles,&#10;                statusFilter = uiState.filters.statusFilter,&#10;                onRoleToggle = usersViewModel::onRoleFilterChange,&#10;                onStatusFilterChange = usersViewModel::onStatusFilterChange,&#10;                onClear = usersViewModel::clearFilters,&#10;                onDismiss = { showFilters = false }&#10;            )&#10;        }&#10;&#10;        // Diálogo de confirmación para activar/desactivar&#10;        if (showToggleDialog &amp;&amp; userToModify != null) {&#10;            AlertDialog(&#10;                onDismissRequest = {&#10;                    showToggleDialog = false&#10;                    userToModify = null&#10;                },&#10;                title = {&#10;                    Text(text = if (userToModify!!.activo) &quot;Desactivar usuario&quot; else &quot;Activar usuario&quot;)&#10;                },&#10;                text = {&#10;                    Text(&#10;                        text = if (userToModify!!.activo) {&#10;                            &quot;¿Desactivar al usuario \&quot;${userToModify!!.username}\&quot;? No podrá acceder al sistema.&quot;&#10;                        } else {&#10;                            &quot;¿Activar al usuario \&quot;${userToModify!!.username}\&quot;?&quot;&#10;                        }&#10;                    )&#10;                },&#10;                confirmButton = {&#10;                    Button(&#10;                        onClick = {&#10;                            usersViewModel.toggleUserActive(userToModify!!.id)&#10;                            showToggleDialog = false&#10;                            userToModify = null&#10;                        }&#10;                    ) {&#10;                        Text(if (userToModify!!.activo) &quot;Desactivar&quot; else &quot;Activar&quot;)&#10;                    }&#10;                },&#10;                dismissButton = {&#10;                    TextButton(onClick = {&#10;                        showToggleDialog = false&#10;                        userToModify = null&#10;                    }) {&#10;                        Text(&quot;Cancelar&quot;)&#10;                    }&#10;                }&#10;            )&#10;        }&#10;&#10;        // Diálogo de confirmación para eliminar&#10;        if (showDeleteDialog &amp;&amp; userToModify != null) {&#10;            cl.duoc.maestranza_v2.ui.components.DeleteConfirmationDialog(&#10;                showDialog = true,&#10;                productName = userToModify!!.username,&#10;                onDismiss = {&#10;                    showDeleteDialog = false&#10;                    userToModify = null&#10;                },&#10;                onConfirm = {&#10;                    usersViewModel.deleteUser(userToModify!!.id)&#10;                    showDeleteDialog = false&#10;                    userToModify = null&#10;                }&#10;            )&#10;        }&#10;&#10;        // Bottom sheet para agregar usuario&#10;        if (showAddUser) {&#10;            AddUserBottomSheet(&#10;                availableRoles = uiState.availableRoles,&#10;                existingUsers = uiState.users,&#10;                onDismiss = { showAddUser = false },&#10;                onUserAdded = { newUser -&gt;&#10;                    usersViewModel.addUser(newUser)&#10;                    showAddUser = false&#10;                }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@SuppressLint(&quot;ViewModelConstructorInComposable&quot;)&#10;@Preview(&#10;    showBackground = true,&#10;    name = &quot;User Compact&quot;,&#10;    device = &quot;spec:width=411dp,height=891dp,dpi=420&quot;&#10;)&#10;@Composable&#10;fun UserScreenCompactPreview() {&#10;    Maestranza_V2Theme {&#10;        UserScreenCompact(&#10;            navController = rememberNavController(),&#10;            viewModel = MainViewModel()&#10;        )&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package cl.duoc.maestranza_v2.ui.screens.users&#13;&#10;&#13;&#10;import android.annotation.SuppressLint&#13;&#10;import androidx.compose.foundation.horizontalScroll&#13;&#10;import androidx.compose.foundation.layout.*&#13;&#10;import androidx.compose.foundation.lazy.LazyColumn&#13;&#10;import androidx.compose.foundation.lazy.items&#13;&#10;import androidx.compose.foundation.rememberScrollState&#13;&#10;import androidx.compose.material.icons.Icons&#13;&#10;import androidx.compose.material.icons.filled.Add&#13;&#10;import androidx.compose.material.icons.filled.FilterList&#13;&#10;import androidx.compose.material.icons.filled.Search&#13;&#10;import androidx.compose.material3.*&#13;&#10;import androidx.compose.runtime.*&#13;&#10;import androidx.compose.runtime.getValue&#13;&#10;import androidx.compose.runtime.setValue&#13;&#10;import androidx.compose.ui.Modifier&#13;&#10;import androidx.compose.ui.tooling.preview.Preview&#13;&#10;import androidx.compose.ui.unit.dp&#13;&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#13;&#10;import androidx.navigation.NavController&#13;&#10;import androidx.navigation.compose.rememberNavController&#13;&#10;import cl.duoc.maestranza_v2.model.User&#13;&#10;import cl.duoc.maestranza_v2.ui.components.AddUserBottomSheet&#13;&#10;import cl.duoc.maestranza_v2.ui.components.UserCard&#13;&#10;import cl.duoc.maestranza_v2.ui.components.UsersFilterBottomSheet&#13;&#10;import cl.duoc.maestranza_v2.ui.theme.Maestranza_V2Theme&#13;&#10;import cl.duoc.maestranza_v2.viewmodel.MainViewModel&#13;&#10;import cl.duoc.maestranza_v2.viewmodel.UsersViewModel&#13;&#10;&#13;&#10;@OptIn(ExperimentalMaterial3Api::class)&#13;&#10;@Composable&#13;&#10;fun UserScreenCompact(&#13;&#10;    navController: NavController,&#13;&#10;    viewModel: MainViewModel,&#13;&#10;    usersViewModel: UsersViewModel = viewModel()&#13;&#10;) {&#13;&#10;    val uiState by usersViewModel.uiState.collectAsState()&#13;&#10;    var showFilters by remember { mutableStateOf(false) }&#13;&#10;    var showDeleteDialog by remember { mutableStateOf(false) }&#13;&#10;    var showToggleDialog by remember { mutableStateOf(false) }&#13;&#10;    var showAddUser by remember { mutableStateOf(false) }&#13;&#10;    var userToModify by remember { mutableStateOf&lt;User?&gt;(null) }&#13;&#10;&#13;&#10;    cl.duoc.maestranza_v2.ui.components.ScaffoldWrapper(&#13;&#10;        navController = navController,&#13;&#10;        showDrawer = true,&#13;&#10;        title = &quot;Usuarios&quot;,&#13;&#10;        actions = {&#13;&#10;            IconButton(onClick = { showFilters = true }) {&#13;&#10;                Icon(Icons.Default.FilterList, contentDescription = &quot;Filtros&quot;)&#13;&#10;            }&#13;&#10;        },&#13;&#10;        floatingActionButton = {&#13;&#10;            FloatingActionButton(&#13;&#10;                onClick = { showAddUser = true }&#13;&#10;            ) {&#13;&#10;                Icon(Icons.Default.Add, contentDescription = &quot;Agregar usuario&quot;)&#13;&#10;            }&#13;&#10;        }&#13;&#10;    ) { innerPadding -&gt;&#13;&#10;        Column(&#13;&#10;            modifier = Modifier&#13;&#10;                .padding(innerPadding)&#13;&#10;                .fillMaxSize()&#13;&#10;                .padding(horizontal = 16.dp)&#13;&#10;        ) {&#13;&#10;            // Campo de búsqueda&#10;            OutlinedTextField(&#10;                value = uiState.query,&#10;                onValueChange = usersViewModel::onQueryChange,&#10;                label = { Text(&quot;Buscar usuario, nombre o email&quot;) },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                trailingIcon = { Icon(Icons.Default.Search, null) },&#10;                singleLine = true&#10;            )&#13;&#10;&#13;&#10;            Spacer(Modifier.height(8.dp))&#13;&#10;&#13;&#10;            // Chips con filtros activos&#13;&#10;            if (uiState.filters.selectedRoles.isNotEmpty() || uiState.filters.statusFilter != cl.duoc.maestranza_v2.model.UserStatusFilter.All) {&#13;&#10;                Row(Modifier.horizontalScroll(rememberScrollState())) {&#13;&#10;                    uiState.filters.selectedRoles.forEach { role -&gt;&#13;&#10;                        val roleFormatted = when (role) {&#13;&#10;                            &quot;ROLE_ADMINISTRADOR&quot; -&gt; &quot;Administrador&quot;&#13;&#10;                            &quot;ROLE_AUDITOR&quot; -&gt; &quot;Auditor&quot;&#13;&#10;                            &quot;ROLE_COMPRAS&quot; -&gt; &quot;Compras&quot;&#13;&#10;                            &quot;ROLE_VENTAS&quot; -&gt; &quot;Ventas&quot;&#13;&#10;                            &quot;ROLE_SUPERVISOR&quot; -&gt; &quot;Supervisor&quot;&#13;&#10;                            &quot;ROLE_EMPLEADO&quot; -&gt; &quot;Empleado&quot;&#13;&#10;                            else -&gt; role&#13;&#10;                        }&#13;&#10;                        AssistChip(&#13;&#10;                            onClick = { showFilters = true },&#13;&#10;                            label = { Text(roleFormatted) },&#13;&#10;                            trailingIcon = {&#13;&#10;                                Icon(&#13;&#10;                                    Icons.Default.FilterList,&#13;&#10;                                    contentDescription = null,&#13;&#10;                                    modifier = Modifier.size(16.dp)&#13;&#10;                                )&#13;&#10;                            }&#13;&#10;                        )&#13;&#10;                        Spacer(Modifier.width(8.dp))&#13;&#10;                    }&#13;&#10;&#13;&#10;                    if (uiState.filters.statusFilter != cl.duoc.maestranza_v2.model.UserStatusFilter.All) {&#13;&#10;                        AssistChip(&#13;&#10;                            onClick = { showFilters = true },&#13;&#10;                            label = { Text(uiState.filters.statusFilter.name) },&#13;&#10;                            trailingIcon = {&#13;&#10;                                Icon(&#13;&#10;                                    Icons.Default.FilterList,&#13;&#10;                                    contentDescription = null,&#13;&#10;                                    modifier = Modifier.size(16.dp)&#13;&#10;                                )&#13;&#10;                            }&#13;&#10;                        )&#13;&#10;                    }&#13;&#10;                }&#13;&#10;                Spacer(Modifier.height(8.dp))&#13;&#10;            }&#13;&#10;&#13;&#10;            // Lista de usuarios con cards&#13;&#10;            LazyColumn(&#13;&#10;                verticalArrangement = Arrangement.spacedBy(8.dp),&#13;&#10;                modifier = Modifier.fillMaxSize()&#13;&#10;            ) {&#13;&#10;                items(uiState.filteredUsers, key = { it.id }) { user -&gt;&#13;&#10;                    UserCard(&#13;&#10;                        user = user,&#13;&#10;                        onClick = { /* TODO: Detalle rápido */ },&#13;&#10;                        onEdit = { userId -&gt;&#13;&#10;                            navController.navigate(&#13;&#10;                                cl.duoc.maestranza_v2.navigation.Screen.EditUser.createRoute(userId)&#13;&#10;                            )&#13;&#10;                        },&#13;&#10;                        onToggleActive = {&#13;&#10;                            userToModify = user&#13;&#10;                            showToggleDialog = true&#13;&#10;                        },&#13;&#10;                        onDelete = {&#13;&#10;                            userToModify = user&#13;&#10;                            showDeleteDialog = true&#13;&#10;                        }&#13;&#10;                    )&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        // Bottom sheet de filtros&#13;&#10;        if (showFilters) {&#13;&#10;            UsersFilterBottomSheet(&#13;&#10;                availableRoles = uiState.availableRoles,&#13;&#10;                selectedRoles = uiState.filters.selectedRoles,&#13;&#10;                statusFilter = uiState.filters.statusFilter,&#13;&#10;                onRoleToggle = usersViewModel::onRoleFilterChange,&#13;&#10;                onStatusFilterChange = usersViewModel::onStatusFilterChange,&#13;&#10;                onClear = usersViewModel::clearFilters,&#13;&#10;                onDismiss = { showFilters = false }&#13;&#10;            )&#13;&#10;        }&#13;&#10;&#13;&#10;        // Diálogo de confirmación para activar/desactivar&#13;&#10;        if (showToggleDialog &amp;&amp; userToModify != null) {&#13;&#10;            AlertDialog(&#13;&#10;                onDismissRequest = {&#13;&#10;                    showToggleDialog = false&#13;&#10;                    userToModify = null&#13;&#10;                },&#13;&#10;                title = {&#13;&#10;                    Text(text = if (userToModify!!.activo) &quot;Desactivar usuario&quot; else &quot;Activar usuario&quot;)&#13;&#10;                },&#13;&#10;                text = {&#13;&#10;                    Text(&#13;&#10;                        text = if (userToModify!!.activo) {&#13;&#10;                            &quot;¿Desactivar al usuario \&quot;${userToModify!!.username}\&quot;? No podrá acceder al sistema.&quot;&#13;&#10;                        } else {&#13;&#10;                            &quot;¿Activar al usuario \&quot;${userToModify!!.username}\&quot;?&quot;&#13;&#10;                        }&#13;&#10;                    )&#13;&#10;                },&#13;&#10;                confirmButton = {&#13;&#10;                    Button(&#13;&#10;                        onClick = {&#13;&#10;                            usersViewModel.toggleUserActive(userToModify!!.id)&#13;&#10;                            showToggleDialog = false&#13;&#10;                            userToModify = null&#13;&#10;                        }&#13;&#10;                    ) {&#13;&#10;                        Text(if (userToModify!!.activo) &quot;Desactivar&quot; else &quot;Activar&quot;)&#13;&#10;                    }&#13;&#10;                },&#13;&#10;                dismissButton = {&#13;&#10;                    TextButton(onClick = {&#13;&#10;                        showToggleDialog = false&#13;&#10;                        userToModify = null&#13;&#10;                    }) {&#13;&#10;                        Text(&quot;Cancelar&quot;)&#13;&#10;                    }&#13;&#10;                }&#13;&#10;            )&#13;&#10;        }&#13;&#10;&#13;&#10;        // Diálogo de confirmación para eliminar&#13;&#10;        if (showDeleteDialog &amp;&amp; userToModify != null) {&#13;&#10;            cl.duoc.maestranza_v2.ui.components.DeleteConfirmationDialog(&#13;&#10;                showDialog = true,&#13;&#10;                productName = userToModify!!.username,&#13;&#10;                onDismiss = {&#13;&#10;                    showDeleteDialog = false&#13;&#10;                    userToModify = null&#13;&#10;                },&#13;&#10;                onConfirm = {&#13;&#10;                    usersViewModel.deleteUser(userToModify!!.id)&#13;&#10;                    showDeleteDialog = false&#13;&#10;                    userToModify = null&#13;&#10;                }&#13;&#10;            )&#13;&#10;        }&#13;&#10;&#13;&#10;        // Bottom sheet para agregar usuario&#13;&#10;        if (showAddUser) {&#13;&#10;            AddUserBottomSheet(&#13;&#10;                availableRoles = uiState.availableRoles,&#13;&#10;                existingUsers = uiState.users,&#13;&#10;                onDismiss = { showAddUser = false },&#13;&#10;                onUserAdded = { newUser -&gt;&#13;&#10;                    usersViewModel.addUser(newUser)&#13;&#10;                    showAddUser = false&#13;&#10;                }&#13;&#10;            )&#13;&#10;        }&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;@SuppressLint(&quot;ViewModelConstructorInComposable&quot;)&#13;&#10;@Preview(&#13;&#10;    showBackground = true,&#13;&#10;    name = &quot;User Compact&quot;,&#13;&#10;    device = &quot;spec:width=411dp,height=891dp,dpi=420&quot;&#13;&#10;)&#13;&#10;@Composable&#13;&#10;fun UserScreenCompactPreview() {&#13;&#10;    Maestranza_V2Theme {&#13;&#10;        UserScreenCompact(&#13;&#10;            navController = rememberNavController(),&#13;&#10;            viewModel = MainViewModel()&#13;&#10;        )&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>